@using Microsoft.AspNetCore.Identity;
@inject SignInManager<Users> signInManager;
@inject UserManager<Users> userManager;

@if (signInManager.IsSignedIn(User))
{
	var userProfilePicture = User.FindFirst("ProfilePictureUrl")?.Value ?? "/default-profile.png";
	var isSuperAdmin = User.IsInRole("SuperAdmin");

	<div class="dropdown">
		<a class="d-flex align-items-center gap-2 text-white text-decoration-none dropdown-toggle bg-primary p-2 rounded"
			href="#" role="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false"
			style="height: 40px;">

			@if (!isSuperAdmin)
			{
				<img src="@userProfilePicture" onerror="this.src='/default-profile.png';" class="rounded-circle"
					style="height:40px;width:40px;" alt="Profile Picture">
			}
			else
			{
				<i class="fas fa-user-shield text-white rounded-circle bg-dark d-flex align-items-center justify-content-center"
					style="height:40px; width:40px; font-size: 20px;"></i>
			}
		</a>
		<ul class="dropdown-menu dropdown-menu-end bg-primary border-0 shadow rounded-3 p-2"
			aria-labelledby="profileDropdown" style="min-width: 220px;">

			<!-- 🏠 Dashboard Button -->
			<li>
				<a class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2" asp-controller="Dashboard"
					asp-action="Index">
					<i class="fas fa-tachometer-alt"></i> Dashboard
				</a>
			</li>

			<li>
				<a class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2" href="#">
					<i class="fas fa-cog"></i> Settings
				</a>
			</li>

			@if (isSuperAdmin)
			{
				<li>
					<hr class="dropdown-divider bg-white opacity-50">
				</li>
				<li>
					<span class="dropdown-header text-uppercase text-warning small">Admin</span>
				</li>

				<li>
					<a class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2"
						asp-controller="UsersManagement" asp-action="Index">
						<i class="fas fa-users-cog"></i> User Management
					</a>
				</li>
				<li>
					<a class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2"
						asp-controller="RolesManagement" asp-action="Index">
						<i class="fas fa-user-shield"></i> Role Management
					</a>
				</li>
				<li>
					<a class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2"
						asp-controller="RolesManagement" asp-action="Index">
						<i class="fas fa-notes-medical"></i> User Health Management
					</a>
				</li>

			}

			<li>
				<hr class="dropdown-divider bg-white opacity-50">
			</li>

			<!-- 🚪 Logout -->
			<li>
				<form asp-controller="Account" asp-action="Logout" method="post" class="d-inline w-100">
					<button type="submit" class="dropdown-item text-white d-flex align-items-center gap-2 rounded-2">
						<i class="fas fa-sign-out-alt"></i> Logout
					</button>
				</form>
			</li>
		</ul>
	</div>
}
else
{
	<a class="nav-link text-white" asp-controller="Account" asp-action="Login">
		<i class="fas fa-sign-in-alt"></i> Login
	</a>
}
